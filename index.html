<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>建物コスト算出システム - Hotel LCC-SaaS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #f0f2f5; --white: #ffffff; }
        body { font-family: "Segoe UI", "Meiryo", sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .header { background: var(--primary); color: white; padding: 10px 20px; font-size: 1.2rem; font-weight: bold; }
        .main-container { display: grid; grid-template-columns: 320px 1fr; flex: 1; overflow: hidden; }
        .sidebar { background: #e9ecef; padding: 15px; border-right: 1px solid #ccc; overflow-y: auto; font-size: 0.9rem; }
        .content { padding: 20px; overflow-y: auto; display: flex; flex-direction: column; }
        .card { background: white; border-radius: 4px; padding: 20px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        h3 { border-left: 5px solid var(--primary); padding-left: 10px; margin-bottom: 15px; font-size: 1rem; }
        .input-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 4px; color: #555; font-weight: bold; }
        select, input { width: 100%; padding: 6px; border: 1px solid #aaa; border-radius: 3px; box-sizing: border-box; }
        .tab-nav { display: flex; gap: 2px; background: #ddd; padding: 5px 5px 0 5px; }
        .tab-btn { padding: 10px 20px; border: none; background: #ccc; cursor: pointer; border-radius: 5px 5px 0 0; }
        .tab-btn.active { background: white; font-weight: bold; border-bottom: 2px solid white; }
        .tab-pane { display: none; background: white; padding: 20px; border: 1px solid #ddd; flex: 1; }
        .tab-pane.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
        th { background: #f8f9fa; text-align: center; }
        .total-banner { background: #2c3e50; color: #00d4ff; padding: 15px; border-radius: 4px; font-size: 1.2rem; font-weight: bold; text-align: center; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="header">建物コスト算出システム Pro (Python Logic v12)</div>

<div class="main-container">
    <div class="sidebar">
        <h3>基本条件 (建物概要)</h3>
        <div class="input-group"><label>建物構造</label>
            <select id="struct" onchange="run()"><option value="RC">RC造</option><option value="S">鉄骨造</option><option value="SRC">SRC造</option><option value="W">木造</option></select>
        </div>
        <div class="input-group"><label>グレード</label>
            <select id="grade" onchange="run()"><option value="0">Gensen</option><option value="1">Premium1</option><option value="2">Premium2</option><option value="3">TAOYA1</option><option value="4">TAOYA2</option></select>
        </div>
        <div class="input-group"><label>客室数 (室)</label><input type="number" id="rooms" value="100" oninput="run()"></div>
        <div class="input-group"><label>客室面積 (㎡/室)</label><input type="number" id="r_area" value="22" oninput="run()"></div>
        <div class="input-group"><label>共用部比率 (%)</label><input type="number" id="c_ratio" value="35" oninput="run()"></div>
        
        <h3>運営費条件</h3>
        <div class="input-group"><label>人件費 (万円/年)</label><input type="number" id="p_cost" value="5000" oninput="run()"></div>
        <div class="input-group"><label>原価率 (%)</label><input type="number" id="f_ratio" value="30" oninput="run()"></div>
    </div>

    <div class="content">
        <div id="total_display" class="total-banner">新築時工事費合計: 0 万円</div>

        <div class="tab-nav">
            <button class="tab-btn active" onclick="openTab(event, 'tab1')">建設費算出シート</button>
            <button class="tab-btn" onclick="openTab(event, 'tab2')">LCCシミュレーション</button>
            <button class="tab-btn" onclick="openTab(event, 'tab3')">運営費内訳</button>
        </div>

        <div id="tab1" class="tab-pane active">
            <h3>工事費内訳明細</h3>
            <table>
                <thead><tr><th>項目</th><th>数量/面積</th><th>単価(万円)</th><th>金額(万円)</th></tr></thead>
                <tbody id="cost_table_body"></tbody>
            </table>
        </div>

        <div id="tab2" class="tab-pane">
            <h3>75年間の長期修繕計画</h3>
            <canvas id="lccChart" style="max-height: 400px;"></canvas>
        </div>

        <div id="tab3" class="tab-pane">
            <h3>年間運営コスト推定</h3>
            <div id="op_cost_detail"></div>
        </div>
    </div>
</div>

<script>
    function openTab(evt, tabName) {
        let i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-pane");
        for (i = 0; i < tabcontent.length; i++) tabcontent[i].classList.remove("active");
        tablinks = document.getElementsByClassName("tab-btn");
        for (i = 0; i < tablinks.length; i++) tablinks[i].classList.remove("active");
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
    }

    const unitPrices = { "RC": [50, 55, 60, 65, 70], "S": [45, 50, 55, 60, 65], "SRC": [55, 60, 65, 70, 75], "W": [30, 35, 40, 45, 50] };

    function run() {
        const rooms = parseFloat(document.getElementById('rooms').value) || 0;
        const rArea = parseFloat(document.getElementById('r_area').value) || 0;
        const cRatio = (parseFloat(document.getElementById('c_ratio').value) || 0) / 100;
        const struct = document.getElementById('struct').value;
        const grade = parseInt(document.getElementById('grade').value);

        const totalArea = (rooms * rArea) / (1 - cRatio);
        const baseUP = unitPrices[struct][grade];
        const constCost = totalArea * baseUP;

        // 表の更新
        let html = `<tr><td>本体建築工事</td><td>${Math.round(totalArea)} ㎡</td><td>${baseUP}</td><td>${Math.round(constCost).toLocaleString()}</td></tr>`;
        html += `<tr><td>家具・備品(FFE)</td><td>${rooms} 室</td><td>120</td><td>${(rooms * 120).toLocaleString()}</td></tr>`;
        document.getElementById('cost_table_body').innerHTML = html;

        const grandTotal = constCost + (rooms * 120);
        document.getElementById('total_display').innerText = `新築時工事費合計: ${Math.round(grandTotal).toLocaleString()} 万円`;

        updateChart(grandTotal);
    }

    let chart;
    function updateChart(total) {
        const ctx = document.getElementById('lccChart').getContext('2d');
        const data = Array.from({length: 75}, (_, i) => {
            const y = i + 1;
            let cost = total * 0.01;
            if (y % 12 === 0) cost += total * 0.15;
            if (y % 15 === 0) cost += total * 0.10;
            return cost;
        });
        if (chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'bar',
            data: { labels: Array.from({length: 75}, (_, i) => i + 1), datasets: [{ label: '修繕費(万円)', data: data, backgroundColor: '#3498db' }] }
        });
    }
    run();
</script>
</body>
</html>